(this["webpackJsonpkossip-web"]=this["webpackJsonpkossip-web"]||[]).push([[84],{2099:function(e,t,n){"use strict";(function(e){var a,i,o,l=n(41),r=n(85),s=n(12),c=n(8),u=n(9),d=n(14),p=n(15),f=n(53),b=n.n(f),g=n(6),m=n.n(g),h=n(11),j=n(17),v=n(489),O=n(35),U=n(2113),I=n(364),S=n(2158),x=n(0),F=["fileInputRef","className","fileAcceptType"],A=Object(j.inject)("fileUploadStore")(a=Object(j.observer)((o=i=function(t){Object(d.a)(a,t);var n=Object(p.a)(a);function a(){var t;Object(c.a)(this,a);for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return(t=n.call.apply(n,[this].concat(o))).s3FileUploader=void 0,t.getInjectedProps=function(){return t.props},t.onSuccessFileUpload=function(e){(0,t.props.onUploadProgress)(h.API_SUCCESS,e)},t.onFailureFileUpload=function(e,n){(0,t.props.onUploadProgress)(h.API_FAILED,e,n)},t.onSuccessConfigureAws=function(e){var n=t.props,a=n.fileInputRef,i=n.extraBucketPath,o=n.onUploadProgress,l=a.current.files,r=e||[l[0]];return o(h.API_FETCHING),t.fixRotationofImage(r).then((function(e){return Promise.all(e.map((function(e){return"object"===typeof e?t.s3FileUploader.uploadToAWS({extraBucketPath:i,file:e},t.onSuccessFileUpload,t.onFailureFileUpload):null})))})),Promise.resolve(a)},t.uploadFiles=function(e){var n=t.getInjectedProps().fileUploadStore;t.s3FileUploader=new v.a(n),t.s3FileUploader.configureAWS((function(){t.onSuccessConfigureAws(e)}),(function(e){t.onFailureFileUpload(Object(O.c)(e),"")}))},t.abortUploadToAWS=function(){t.s3FileUploader.abortUploadToAWS()},t.uploadGivenFiles=function(e){(0,t.props.onUploadProgress)(h.API_FETCHING),t.uploadFiles(e)},t.onSuccessGetFileUploadConfig=function(){t.uploadFiles()},t.onFailureGetFileUploadConfig=function(){var e=t.getInjectedProps().fileUploadStore;(0,t.props.onUploadProgress)(h.API_FAILED,Object(O.c)(e.getFileUploadConfigAPIError))},t.isFileSelected=function(){return t.props.fileInputRef.current.files.length>0},t.upload=function(){var e=t.props.onUploadProgress;t.isFileSelected()&&(e(h.API_FETCHING),t.getFileUploadConfig(t.onSuccessGetFileUploadConfig,t.onFailureGetFileUploadConfig))},t.getFileUploadConfig=function(e,n){t.getInjectedProps().fileUploadStore.getFileUploadConfigAPI(e,n)},t.uploadBase64EncodedFile=function(n,a,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=t.getInjectedProps(),c=r.fileUploadStore,u=t.props.extraBucketPath,d=e.from(n.replace(/^data:image\/\w+;base64,/,""),"base64"),p=n.split(";")[0].split("/")[1],f=null!==p&&void 0!==p?p:"png",b=Object(s.a)({ContentEncoding:"base64",ContentType:"image/".concat(p),extension:f},o),g=new v.a(c);g.configureAWS(void 0,i,l),g.uploadToAWS({file:d,extraBucketPath:u,s3UploadParams:b},a,i,l)},t.onChange=function(){var e=t.props,n=e.onChange,a=e.fileInputRef;n&&n(a)},t}return Object(u.a)(a,[{key:"fixRotationofImage",value:function(){var e=Object(r.a)(b.a.mark((function e(t){var n,a,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props.fileAcceptType,a=[],n!==I.b.image){e.next=13;break}i=0;case 4:if(!(i<t.length)){e.next=12;break}return e.next=7,Object(U.b)(t[i]);case 7:o=e.sent,a.push(o);case 9:i++,e.next=4;break;case 12:return e.abrupt("return",a);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.fileInputRef,n=e.className,a=e.fileAcceptType,i=Object(l.a)(e,F);return Object(x.jsx)(S.a,Object(s.a)(Object(s.a)({"data-testid":"fileUploadInput",className:n,type:"file",accept:a,ref:t},i),{},{onChange:this.onChange}))}}]),a}(g.Component),i.defaultProps={fileInputRef:m.a.createRef(),className:""},a=o))||a)||a;t.a=A}).call(this,n(2196).Buffer)},2113:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return l}));var a=n(732),i=n.n(a);function o(e){var t=!1;return new Promise((function(n){i()(e,(function(e){try{e.toBlob((function(e){n(e)}),"image/jpeg")}catch(a){t=!0}}),{orientation:1}),t&&n(e)}))}function l(e,t){fetch(e).then((function(e){return e.blob()})).then((function(e){var n=new File([e],"image.jpeg",{type:e.type});t(n)}))}},2123:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return o}));var a=function(e,t){var n=document.createElement("a"),a=new Blob([t],{type:"text/plain"});n.href=URL.createObjectURL(a),n.download=e,document.body.appendChild(n),n.click()},i=function(e,t){var n=e.name.split(".").pop();return t.map((function(e){return e.toLowerCase()})).includes(n.toLowerCase())},o=function(e){return e.split(",").map((function(e){return e.trim().substring(1)}))}},2133:function(e,t,n){"use strict";var a,i,o,l,r,s,c,u,d,p,f,b,g=n(3),m=n(8),h=n(9),j=n(13),v=n(14),O=n(15),U=n(2),I=(n(18),n(4)),S=n(6),x=n.n(S),F=n(11),A=n(1),P=n(474),C=n(17),y=(n(2157),n(476)),R=n(81),q=n(2123),E=n(97),N=n(146),k=n(2099),w=n(5),T=I.default.div(a||(a=Object(w.a)([""]))),B=I.default.div(i||(i=Object(w.a)(["\n   display: none;\n"]))),L=n(0),D=Object(I.default)(T).withConfig({displayName:"BaseS3File___StyledBaseImageContainer",componentId:"sc-1h4ybvw-0"})(["",""],(function(e){return e._css})),_=(o=A.action.bound,l=A.action.bound,Object(C.observer)((b=f=function(e){Object(v.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(m.a)(this,n),(a=t.call(this,e)).inputRef=void 0,a.fileUploadRef=void 0,Object(g.a)(a,"uploadingAPIStatus",c,Object(j.a)(a)),Object(g.a)(a,"url",u,Object(j.a)(a)),Object(g.a)(a,"fileName",d,Object(j.a)(a)),a.setFileName=function(e){a.fileName=e},Object(g.a)(a,"onUploadProgress",p,Object(j.a)(a)),a.uploadGivenFiles=function(e){var t,n;null===(t=a.fileUploadRef)||void 0===t||null===(n=t.current)||void 0===n||n.uploadGivenFiles(e)},a.onFileSizeLimitExceed=function(){var e=a.props,t=e.maxLimit,n=e.t,i=e.onLimitExceed;i&&i(),Object(R.d)(n("common:fileUpload.fileSizeMaxLimitReached",{count:t,className:"toast-failure"}))},a.setFileData=function(e){var t=a.props.setBlobImage;a.setUrl(URL.createObjectURL(e)),a.setFileName(e.name),t&&t(a.url)},a.onChange=function(e){var t=a.props,n=t.enableEdit,i=t.maxLimit,o=t.onChange,l=t.disableUploadingOnGetImage,r="";e.current.files.length>0&&(r=e.current.files[0].name),o&&o(r),n&&i&&(e.current.files.length>0&&e.current.files[0].size>1024*i*1024?a.onFileSizeLimitExceed():(l||a.fileUploadRef.current.upload(),e.current.files.length>0&&a.setFileData(e.current.files[0])))},a.onClickUpload=function(){a.props.enableEdit&&a.uploadingAPIStatus!==F.API_FETCHING&&a.inputRef.current.click()},a.onClickAbort=function(){var e;null===(e=a.fileUploadRef.current)||void 0===e||e.abortUploadToAWS()},a.clearFiles=function(){if(a.inputRef.current){var e=a.inputRef.current.files;e&&e.length>0&&(a.inputRef.current.value=null)}},a.onDragOver=function(e){e.preventDefault()},a.onDropFile=function(e){e.preventDefault();var t=a.props,n=t.enableEdit,i=t.maxLimit,o=t.enableDragAndDropFile,l=t.disableUploadingOnGetImage,r=t.fileAcceptType;try{if(Object(N.e)()&&o&&n&&!!r&&!!e.dataTransfer.files){var s=e.dataTransfer.files[0],c=Object(q.b)(r);if(1===e.dataTransfer.files.length&&Object(q.c)(s,c))if(i&&e.dataTransfer.files[0].size>1024*i*1024)a.onFileSizeLimitExceed();else{var u,d,p=e.dataTransfer.files[0];if(!l)null===(u=a.fileUploadRef)||void 0===u||null===(d=u.current)||void 0===d||d.uploadGivenFiles([p]);a.setFileData(p)}}}catch(f){Object(E.a)(f,{dragAndDropFileEventError:"on drag and drop file error"})}},a.inputRef=x.a.createRef(),a.fileUploadRef=x.a.createRef(),a.uploadingAPIStatus=F.API_INITIAL,a}return Object(h.a)(n,[{key:"setUrl",value:function(e){this.url=e}},{key:"setUploadingAPIStatus",value:function(e){var t=this.props.onUploadAPIStatusChange;this.uploadingAPIStatus=e,t&&t(e)}},{key:"render",value:function(){var e=this.props,t=e.renderFileSelector,n=e.renderFileUIState,a=e.fileAcceptType,i=e.extraBucketPath,o=e.containerClassName,l=e.containerCSS,r=e.id;return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)(D,{className:o,onClick:this.onClickUpload,id:r,onDrop:this.onDropFile,onDragOver:this.onDragOver,_css:l,children:[Object(L.jsx)(B,{children:Object(L.jsx)(k.a,{fileAcceptType:a,onUploadProgress:this.onUploadProgress,ref:this.fileUploadRef,fileInputRef:this.inputRef,onChange:this.onChange,extraBucketPath:i})}),t?t(this.url,this.uploadingAPIStatus,this.fileName):null]}),n?n(this.url,this.uploadingAPIStatus,this.fileName):null]})}}]),n}(S.Component),f.defaultProps={enableEdit:!0,maxLimit:5,fileAcceptType:"",shouldEnableUploadFailureToast:!0,enableDragAndDropFile:!1},s=b,c=Object(U.a)(s.prototype,"uploadingAPIStatus",[A.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=Object(U.a)(s.prototype,"url",[A.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=Object(U.a)(s.prototype,"fileName",[A.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(U.a)(s.prototype,"setUrl",[o],Object.getOwnPropertyDescriptor(s.prototype,"setUrl"),s.prototype),Object(U.a)(s.prototype,"setUploadingAPIStatus",[l],Object.getOwnPropertyDescriptor(s.prototype,"setUploadingAPIStatus"),s.prototype),p=Object(U.a)(s.prototype,"onUploadProgress",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){var a=e.props,i=a.onFailFileUpload,o=a.shouldEnableUploadFailureToast,l=a.t;if(t===F.API_FETCHING)e.setUploadingAPIStatus(t);else if(t===F.API_SUCCESS){var r=e.props.onSuccessImageUpload;e.setUploadingAPIStatus(t),e.setUrl(n),r&&r(e.url)}else t===F.API_FAILED&&(e.setUploadingAPIStatus(t),i&&i(n),o&&(Object(y.e)(n)?Object(R.d)(l("common:common.skewErrorToastMessage"),{autoClose:5e3,className:"toast-failure"}):Object(R.d)(n,{className:"toast-failure"})))}}}),r=s))||r);t.a=Object(P.a)("translation",{withRef:!0})(_)},2157:function(e,t,n){},2158:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a,i=n(5),o=n(4).default.input(a||(a=Object(i.a)([""])))},3922:function(e,t,n){"use strict";n.r(t);var a=n(85),i=n(101),o=n(3),l=n(8),r=n(9),s=n(13),c=n(14),u=n(15),d=n(2),p=(n(18),n(53)),f=n.n(p),b=n(6),g=n(3651),m=n.n(g),h=n(2915),j=n.n(h);window.hljs=j.a;var v=n(2916),O=n.n(v),U=n(1),I=n(17),S=n(474),x=n(11),F=n(2133),A=n(364),P=n(202),C=n(81),y=(n(2132),n(643)),R=v.Quill.import("formats/link"),q=R.sanitize;R.sanitize=function(e){var t=e;return/^\w+:/.test(t)||/^https?:/.test(t)||(t="http://".concat(t)),q.call(this,t)};var E,N,k,w,T,B,L=n(476),D=n(0),_=function(e){var t=e.id,n=void 0===t?"toolbar":t;return Object(D.jsxs)("div",{id:n,children:[Object(D.jsx)("button",{className:"ql-bold"}),Object(D.jsx)("button",{className:"ql-italic"}),Object(D.jsx)("button",{className:"ql-underline"}),Object(D.jsx)("button",{className:"ql-strike"}),Object(D.jsx)("button",{className:"ql-code-block"}),Object(D.jsx)("button",{className:"ql-list",value:"ordered"}),Object(D.jsx)("button",{className:"ql-list",value:"bullet"}),Object(D.jsx)("button",{className:"ql-link"}),Object(D.jsx)("button",{className:"ql-image"}),Object(D.jsx)("button",{className:"ql-inlineCodeBlock",children:"` `"}),Object(D.jsx)("button",{className:"ql-script",value:"sub"}),Object(D.jsx)("button",{className:"ql-script",value:"super"})]})},H=function(e){var t=e.id,n=void 0===t?"toolbar":t;return Object(D.jsxs)("div",{id:n,children:[Object(D.jsx)("button",{className:"ql-bold"}),Object(D.jsx)("button",{className:"ql-italic"}),Object(D.jsx)("button",{className:"ql-underline"}),Object(D.jsx)("button",{className:"ql-strike"}),Object(D.jsx)("button",{className:"ql-list",value:"ordered"}),Object(D.jsx)("button",{className:"ql-list",value:"bullet"}),Object(D.jsx)("button",{className:"ql-link"}),Object(D.jsx)("button",{className:"ql-image"})]})},z=Object(I.observer)((B=T=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).quillRef=void 0,r.quill=void 0,r.range=void 0,r.toolbarId=void 0,r.maxLimit=5,Object(o.a)(r,"baseS3Ref",k,Object(s.a)(r)),Object(o.a)(r,"editorHtml",w,Object(s.a)(r)),r.onSpace=function(){r.quill=r.quillRef.getEditor();var e=r.quill.getSelection(!0);if(e){var t=r.quill.getLine(e.index),n=Object(i.a)(t,2),a=n[0],o=n[1],l=a.domNode.textContent,s=e.index-o;e.length=e.index++;var c=/(?:`)(.+?)(?:`)/g.exec(l);if(c){var u=c[0],d=c[1],p=s+c.index;r.quill.deleteText(p,u.length),r.quill.insertText(p,d,{code:!0}),r.quill.format("code",!1)}}},r.getPlaceholderImageUrl=function(e){return e<1024*r.maxLimit*1024?"https://d15dkfioxfhy94.cloudfront.net/tenxiitian_prod/website-static/collegeid_placeholder.png":""},r.imageHandler=function(){var e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=Object(a.a)(f.a.mark((function t(){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.files&&(r.baseS3Ref.current.inputRef.current.files=e.files,r.baseS3Ref.current.onChange({current:{files:e.files}}),r.quill=r.quillRef.getEditor(),n=e.files[0],(new FormData).append("image",n),r.range=r.quill.getSelection(!0),r.quill.insertEmbed(r.range.index,"image",r.getPlaceholderImageUrl(n.size)),r.quill.setSelection(r.range.index+1));case 1:case"end":return t.stop()}}),t)})))},r.inlineCodeBlock=function(){r.quill=r.quillRef.getEditor(),r.range=r.quill.getSelection(!0);var e=r.range.index+r.range.length;r.quill.insertText(r.range.index,"`"),r.quill.insertText(e+1,"`"),r.quill.setSelection(e+1)},r.replaceBase64UrlWithS3Url=function(e,t){var n=r.editorHtml.replace(e,t);r.editorHtml=n},r.removeBase64ImageFromEditor=function(e){var t=r.editorHtml.toString();r.editorHtml=t.replace('<img src="'.concat(e,'">'),"")},r.onConfigFailure=function(e,t){r.removeBase64ImageFromEditor(e),Object(C.d)(t)},r.onS3UploadFailure=function(e,t){var n=r.props.t;r.removeBase64ImageFromEditor(e),Object(L.e)(t)?Object(C.d)(n("common:common.skewErrorToastMessage")):Object(C.d)(t.message)},r.getS3Url=function(){var e=Object(a.a)(f.a.mark((function e(t){var n,a,i,o,l,s,c,u,d,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=r.baseS3Ref)||void 0===n||!n.current||null===(a=r.baseS3Ref)||void 0===a||null===(i=a.current)||void 0===i||null===(o=i.fileUploadRef)||void 0===o||!o.current){e.next=5;break}return u=null===(l=r.baseS3Ref)||void 0===l||null===(s=l.current)||void 0===s||null===(c=s.fileUploadRef)||void 0===c?void 0:c.current,d=u.getFileUploadConfig,p=u.uploadBase64EncodedFile,r.onImageUploadAPIStatusChange(x.API_FETCHING),e.next=5,d((function(){p(t,(function(e){r.onImageUploadAPIStatusChange(x.API_SUCCESS),r.replaceBase64UrlWithS3Url(t,e)}),(function(e){r.onImageUploadAPIStatusChange(x.API_FAILED),r.onS3UploadFailure(t,e)}))}),(function(e){r.onImageUploadAPIStatusChange(x.API_FAILED),r.onConfigFailure(t,e)}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.handleChange=function(e){var t=e.match(/data:image\/([a-zA-Z]*);base64,([^"]*)/g);t&&r.getS3Url(t[0]),r.editorHtml=e},r.getEditorData=function(){return r.editorHtml},r.getModules=function(){return{syntax:!0,toolbar:{container:"#".concat(r.toolbarId),handlers:{image:r.imageHandler,inlineCodeBlock:r.inlineCodeBlock}},clipboard:{matchVisual:!1}}},r.onImageUploadAPIStatusChange=function(e){var t=r.props.onImageUploadAPIStatusChange;t&&t(e)},r.onFailFileUpload=function(){r.quill.deleteText(r.range.index,1)},r.onSuccessImageUpload=function(e){r.quill.deleteText(r.range.index,1),r.quill.insertEmbed(r.range.index,"image",e),r.quill.setSelection(r.range.index+1),r.quill.insertEmbed(r.range.index+1,"\n",null),r.quill.setSelection(r.range.index+2)},r.renderUploadButton=function(){return null},r.quillRef=b.createRef(),r.baseS3Ref=b.createRef(),r.editorHtml=e.discussion?e.discussion:"",r.toolbarId="toolbar".concat(Object(P.b)(0,100).toString()),m.a.configure({languages:["c","html","cpp","python","javascript","java"]}),r}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.discussionToolBarLoaded,a=t.shouldFocusEditor;n(),this.quillRef.getEditor().on("text-change",(function(t,n,a){for(var i=0;i<t.ops.length;i++)t.ops[i].hasOwnProperty("insert")&&" "===t.ops[i].insert&&e.onSpace()}));try{var i=document.getElementsByClassName("ql-editor");Array.from(i).forEach((function(e){return e.removeAttribute("data-gramm")}))}catch(o){}if(a)try{setTimeout((function(){var t;null===(t=e.quillRef)||void 0===t||t.focus()}),y.b)}catch(o){}}},{key:"render",value:function(){var e=this,t=this.props,n=t.isNotes,a=t.renderBottomButtons;return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(F.a,{fileAcceptType:A.b.image,ref:this.baseS3Ref,renderFileSelector:this.renderUploadButton,onSuccessImageUpload:this.onSuccessImageUpload,extraBucketPath:A.a.discussionAttachment,onFailFileUpload:this.onFailFileUpload,onUploadAPIStatusChange:this.onImageUploadAPIStatusChange,maxLimit:this.maxLimit}),n?Object(D.jsx)(H,{id:this.toolbarId}):Object(D.jsx)(_,{id:this.toolbarId}),Object(D.jsx)(O.a,{ref:function(t){return e.quillRef=t},theme:"snow",onChange:this.handleChange,value:this.editorHtml,modules:this.getModules(),placeholder:this.props.placeholder}),a()]})}}]),n}(b.Component),T.defaultProps={discussion:"",isNotes:!1,shouldFocusEditor:!1},N=B,k=Object(d.a)(N.prototype,"baseS3Ref",[U.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=Object(d.a)(N.prototype,"editorHtml",[U.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=N))||E;t.default=Object(S.a)("translation",{withRef:!0})(z)}}]);
//# sourceMappingURL=84.a4fb14d8.chunk.js.map